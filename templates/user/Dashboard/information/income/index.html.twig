{% extends "user/Dashboard/information/base.html.twig" %}

{% block title%}Mes revenues{% endblock %}
{% block functionality %}
<div class="container-fluid">
    <div class="container">
        <div class="row">
        {% if incomes is not null %}
            <div class="col-12">
                <div class="row">
                    <div class="col-12">
                        <h3>Revenus Annuels</h3>
                    </div>
                </div>
                <div class="row mt-3">
                     <div class="col-8">
                        {% for year, incomeYear in incomes %}
                        <div class="row mb-5">
                            <div class="col-12">
                                <div class="row">
                                    <div class="col-6">
                                        <h4>Revenue de l'année {{ year }}</h4>
                                    </div>
                                    <div class="col-6 text-right">
                                        <h4>
                                            {{ incomeYear.amount }} €
                                        </h4>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-6">
                                        <p class="mt-3 fw-bold">Ajouter un document en lien avec l'année {{ year }}</p>
                                        <div class="row">
                                            <div class="col-12">
                                            {% for document in incomeYear.document %}
                                                <p>
                                                    {{ document.label }} - 
                                                    <span>
                                                        <a href="{{ path('document.download', {'id': document.id, 'token': document.label}) }}" class="btn btn-sm btn-outline-primary"><i class="far fa-eye"></i></a>
                                                    </span>
                                                    <span>
                                                        <a href="{{ path('document.download', {'id': document.id, 'token': document.label}) }}" class="btn btn-sm btn-outline-primary"><i class="fas fa-download"></i></a>
                                                    </span>
                                                    <span>
                                                        <a href="{{ path('document.delete', {'id' : document.id}) }}" class="btn btn-sm btn-outline-danger"><i class="fas fa-times-circle"></i></a>
                                                    </span>
                                                 </p>
                                            {% endfor %}
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                    <!-- Declenchement de modal DocYear -->
                                        <button class="btn btn-outline-primary btn-sm mt-3 DocumentYear btns-modal-year" data-bs-toggle="modal" data-bs-target="#DocYear" data-year-code="{{ year }}" data-id="{{ app.user.id }}">
                                            <i class="fas fa-file-upload"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="row mt-3">
                                    <div class="col-12">
                                    {% for income in incomeYear.incomes %}
                                        <div class="row mt-3 shadow-sm">
                                            <div class="col-12">
                                                <p class="fw-bold">{{ income.label }}</p>
                                            </div>
                                            <div class="col-12">
                                                <p>Type de revenu : <span class="fw-bold">{{ income.type.label }}</span></p>
                                            </div>
                                            <div class="col-12">
                                                <p><span class="fw-bold">{{ income.amount }} €</span> en net</p>
                                            </div>
                                            <div class="col-12">
                                                <div class="row">
                                                    <div class="col-12">
                                                        <div class="row">
                                                            <div class="col-6 text-right">
                                                                <p class="fw-bold">Document lié au revenu {{ income.label }}</p>
                                                            </div>
                                                            <div class="col-6">                                                            
                                                                <!-- Declenchement de modal Doc income -->
                                                                <button class="btn btn-sm btn-outline-primary mt-3 btns-modal-income" data-bs-toggle="modal" data-bs-target="#DocIncome" data-income-id="{{ income.id }}" data-user-id="{{ app.user.id }}">
                                                                    <i class="fas fa-file-upload"></i>
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    {% for document in income.document %}
                                                    <div class="col-12">
                                                        <p>
                                                            <span class="text-black">{{ document.label }}</span> - 
                                                            <span>
                                                                <a href="{{ path('document.display', {'id': document.id, 'token': document.label}) }}" class="btn btn-sm btn-outline-primary"><i class="far fa-eye"></i></a>
                                                            </span>
                                                            <span>
                                                                <a href="{{ path('document.download', {'id': document.id, 'token': document.label}) }}" class="btn btn-sm btn-outline-primary"><i class="fas fa-download"></i></a>
                                                            </span>
                                                            <span>
                                                                <a href="{{ path('document.delete', {'id' : document.id}) }}" class="btn btn-sm btn-outline-danger"><i class="fas fa-times-circle"></i></a>
                                                            </span>
                                                        </p>
                                                    </div>
                                                    {% endfor %}
                                                </div>
                                            </div>
                                        </div>
                                    {% endfor %}
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    <div class="col-4 shadow">
                        <h4 class="mt-3">Ajouter un revenue</h4>
                        {{ form_start(form) }}
                        <div class="input-group mt-3">
                            {{ form_widget(form.amount) }}
                            <span class="input-group-text">€</span>
                        </div>
                        {{ form_widget(form) }}
                        <input type="submit" class="btn btn-outline-primary mt-3" value="Ajouter">
                        {{ form_end(form) }}
                    </div>
                </div>
            </div>
        {% else %}
        <div class="col-12">
            <div class="row">
                <div class="col-8"></div>
                <div class="col-4 shadow">
                    <h4 class="mt-3">Ajouter un revenue</h4>
                    {{ form_start(form) }}
                    <div class="input-group mt-3">
                        {{ form_widget(form.amount) }}
                        <span class="input-group-text">€</span>
                    </div>
                    {{ form_widget(form) }}
                    <input type="submit" class="btn btn-outline-primary mt-3" value="Ajouter">
                    {{ form_end(form) }}
                </div>
            </div>
        </div>
        {% endif %}
        </div>
    </div>
</div>
 <!-- Modal Document Year -->
            <div class="modal fade" id="DocYear" tabindex="-1" aria-labelledby="document-year" aria-hidden="true">
                 <div class="modal-dialog">
                     <div class="modal-content">
                         <div class="modal-header">
                             <h5 class="modal-title" id="document-year">Ajouter un document</h5>
                             <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                         </div>
                         <div class="modal-body">
                            {{ form_start(formDocYear, {'attr': {'id' : 'formDocYear'}}) }}
                            {{ form_widget(formDocYear) }}
                         </div>
                        <div class="modal-footer">
                             <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Annuler</button>
                            <button type="submit" class="btn btn-outline-primary" id="addDocYear">Ajouter un document</button>
                        </div>
                        {{ form_end(formDocYear) }}
                    </div>
                </div>
            </div>
 <!-- Modal Document Incomes -->
            <div class="modal fade" id="DocIncome" tabindex="-1" aria-labelledby="document-income" aria-hidden="true">
                 <div class="modal-dialog">
                     <div class="modal-content">
                         <div class="modal-header">
                             <h5 class="modal-title" id="document-income">Ajouter un document</h5>
                             <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                         </div>
                         <div class="modal-body">
                            {{ form_start(formDocIncome, {'attr': {'id': 'formDocIncome'}}) }}
                            {{ form_widget(formDocIncome) }}
                         </div>
                        <div class="modal-footer">
                             <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Annuler</button>
                            <button type="submit" class="btn btn-outline-primary" id="addDocIncome">Ajouter un document</button>
                        </div>
                        {{ form_end(formDocIncome) }}
                    </div>
                </div>
            </div>
{% endblock %}
{% block javascripts %}
{{ parent() }}
{{ encore_entry_script_tags('upload_doc_income') }}
{% endblock %}